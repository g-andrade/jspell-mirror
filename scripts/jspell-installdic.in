#!/usr/bin/perl

use warnings;
use strict;

use File::Which qw/which/;
use File::Copy;
use File::Spec::Functions;
use File::Path;
use LWP::Simple;
use Archive::Any;

####################################
my @dics = qw.en pt.;
my %dics;
@dics{@dics}=@dics;
####################################

while (@ARGV) {
    my $language = lc(shift @ARGV);
    warn "Dictionary $language not available\n" unless exists $dics{$language};

    my $host = 'http://natura.di.uminho.pt/';
    my $url = "${host}download/sources/Dictionaries/jspell/jspell.${language}-bin-latest.tar.gz";

    install_dic($url);
}

sub install_dic {
    my $dicurl = shift;
    if (is_success(getstore($dicurl, "dic.tar.gz"))) {
    	my $archive = Archive::Any->new("dic.tar.gz");
	
    	my ($dir,@files) = $archive->files;
    	$archive->extract();	

        my $destpath = catfile("[% LIBDIR %]","jspell");	
    	mkpath($destpath);
	
    	for (@files) {
    	    if (m!\.(irr|yaml|hash)$!) {
    	        $_ =~ s/$dir//;
        		my ($from, $to) = (catfile($dir,$_), catfile($destpath,$_));
        		print "Installing [$_] as [$to]\n";
        		copy(catfile($dir,$_),catfile($destpath,$_));
    	    }
    	}
    	unlink "dic.tar.gz";
    	rmtree($dir,1,1);
	
    } else {
    	print STDERR "I can't access the dictionary server this time.\n";
    	print STDERR "You will need to install dictionaries manually.\n";
    }
}


=head1 NAME

jspell-installdic - automates the installation of a remote jspell dictionary

=head1 SYNOPSIS

   jspell-installdic pt en

=head1 DESCRIPTION

Tries to fetch a binary jspell dictionary distribution for the
supplied languages and install them on the system

=head1 SEE ALSO

jspell(1), Lingua::Jspell(3), perl(1)

=head1 AUTHOR

Alberto Manuel Brand찾o Sim천es, E<lt>ambs@cpan.orgE<gt>

=head1 COPYRIGHT AND LICENSE

Copyright (C) 2010 by Alberto Manuel Brand찾o Sim천es

=cut
